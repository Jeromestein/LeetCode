
| Category   | Difficulty       | Likes | Dislikes |
| ---------- | ---------------- | ----- | -------- |
| algorithms | #Medium (71.56%) | 1733  | 134      |

**Tags**

[`Unknown`](https://leetcode.com/tag/Unknown?source=vscode "https://leetcode.com/tag/Unknown?source=vscode") #array #heap #math #greedy 

**Companies**

`Unknown`

There is a school that has classes of students and each class will be having a final exam. You are given a 2D integer array `classes`, where `classes[i] = [passi, totali]`. You know beforehand that in the `ith` class, there are `totali` total students, but only `passi` number of students will pass the exam.

You are also given an integer `extraStudents`. There are another `extraStudents` brilliant students that are **guaranteed** to pass the exam of any class they are assigned to. You want to assign each of the `extraStudents` students to a class in a way that **maximizes** the **average** pass ratio across **all** the classes.

The **pass ratio** of a class is equal to the number of students of the class that will pass the exam divided by the total number of students of the class. The **average pass ratio** is the sum of pass ratios of all the classes divided by the number of the classes.

Return _the **maximum** possible average pass ratio after assigning the_ `extraStudents` _students._ Answers within `10-5` of the actual answer will be accepted.

**Example 1:**

```
Input: classes = [[1,2],[3,5],[2,2]], extraStudents = 2
Output: 0.78333
Explanation: You can assign the two extra students to the first class. The average pass ratio will be equal to (3/4 + 3/5 + 2/2) / 3 = 0.78333.
```

**Example 2:**

```
Input: classes = [[2,4],[3,9],[4,5],[2,10]], extraStudents = 4
Output: 0.53485
```

**Constraints:**

- `1 <= classes.length <= 105`
- `classes[i].length == 2`
- `1 <= passi <= totali <= 105`
- `1 <= extraStudents <= 105`

---

[Submissions](https://leetcode.com/problems/maximum-average-pass-ratio/submissions/?source=vscode "https://leetcode.com/problems/maximum-average-pass-ratio/submissions/?source=vscode") | [Solution](https://leetcode.com/problems/maximum-average-pass-ratio/solutions/?source=vscode "https://leetcode.com/problems/maximum-average-pass-ratio/solutions/?source=vscode")

```python

class Solution:
    def maxAverageRatio(self, classes: List[List[int]], extraStudents: int) -> float:
        # (x+1)/(y+1) - x/y
        # = (y-x)/y(y+1)
        # sort this (*-1 in python heapq)

        increments=[]
        # build the heap
        for c in classes:
            x,y=c[0],c[1]
            incre=(y-x)/(y*(y+1))
            heapq.heappush(increments,(-incre,x,y))

        for i in range(extraStudents):
            _, x, y=heapq.heappop(increments)
            x+=1
            y+=1
            incre=(y-x)/(y*(y+1))
            heapq.heappush(increments,(-incre,x,y))

        pass_ratio=0
        n=len(classes)
        for i in increments:
            _,x,y=i
            pass_ratio+= x/y/n

        return pass_ratio

```

#### Complexity Analysis

Let n be the number of classes in the `classes` array and k be the number of extra students.

- Time complexity: O(k⋅log(n)+n)
    
    Building the max heap: Inserting each class into the max heap takes O(logn) time per insertion, and since there are n classes, this step takes O(nlogn) time.
    
    - Distributing extra students: Each insertion and removal from the max heap takes O(logn) time. Since we perform this operation k⋅ times, this step takes O(k⋅logn) time.
    - Calculating the final average pass ratio: This involves iterating through the heap, which takes O(nlogn) time in the worst case.
    
    Overall, the dominant factor is the initial heap construction and the distribution of extra students, leading to a time complexity of O(klogn+nlogn)=O(k⋅log(n)+n).
    

> Note: When we create an array and directly heapify it, the process takes O(n) time to convert the array into a valid heap. If we then perform k additional operations (e.g., extracting or inserting elements), each operation takes O(log(n)), leading to a total complexity of O(k⋅log(n)+n).

- Space complexity: O(n)
    
    The space complexity is determined by the max heap, which stores n elements (one for each class). Additionally, the lambda function and other local variables consume constant space.
    
    Therefore, the space complexity is O(n).